<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Isaac Arcade</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    body {
      background: center / cover no-repeat url('bg.jpeg');
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      gap: 12px; padding: 12px; box-sizing: border-box;
      -webkit-user-select: none; -ms-user-select: none; user-select: none;
    }
    h1 { margin: 0; color: #fff; text-align: center; }
    #ruffle-container { width: 100%; max-width: 900px; height: 0; padding-top: 75%; position: relative; border-radius: 8px; overflow: hidden; background: transparent; }
    #ruffle-player { position: absolute; inset: 0; width: 100%; height: 100%; }
    .controls { width: 100%; max-width: 900px; display: flex; gap: 12px; justify-content: space-between; align-items: center; box-sizing: border-box; }
    .stick { width: 40%; max-width: 320px; aspect-ratio: 1/1; background: rgba(255,255,255,0.06); border-radius: 12px; display: grid; place-items: center; padding: 6px; }
    .dpad { width: 100%; height: 100%; display: grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(3,1fr); gap: 6px; }
    .dpad button { width: 100%; height: 100%; border-radius: 8px; border: 0; font-weight: 700; font-size: 16px; touch-action: none; }
    .dpad .center { background: transparent; pointer-events: none; }
    .mid-buttons { display: flex; gap: 8px; align-items: center; justify-content: center; }
    .mid-buttons button { padding: 12px 14px; font-weight: 700; border-radius: 8px; border: 0; min-width: 56px; height: 48px; font-size: 16px; }
    .space-btn { min-width: 110px; }
    @media (max-width: 420px) { .stick { width: 46%; } .mid-buttons button { padding: 10px 12px; height: 44px; } }
  </style>
</head>
<body>

  <h1>Isaac Arcade</h1>

  <div id="ruffle-container"></div>

  <div class="controls">
    <div class="stick" id="left-stick">
      <div class="dpad">
        <button data-key="KeyQ" class="center" style="visibility:hidden"></button>
        <button data-key="KeyW">W</button>
        <button data-key="KeyE" style="visibility:hidden"></button>

        <button data-key="KeyA">A</button>
        <div class="center"></div>
        <button data-key="KeyD">D</button>

        <button data-key="KeyZ" style="visibility:hidden"></button>
        <button data-key="KeyS">S</button>
        <button data-key="KeyC" style="visibility:hidden"></button>
      </div>
    </div>

    <div class="mid-buttons">
      <button data-key="KeyQ">Q</button>
      <button data-key="KeyE">E</button>
      <button data-key="Space" class="space-btn">Space</button>
    </div>

    <div class="stick" id="right-stick">
      <div class="dpad">
        <button data-key="ArrowUp">↑</button>
        <button data-key="" class="center" style="visibility:hidden"></button>
        <button data-key="" style="visibility:hidden"></button>

        <button data-key="ArrowLeft">←</button>
        <div class="center"></div>
        <button data-key="ArrowRight">→</button>

        <button data-key="" style="visibility:hidden"></button>
        <button data-key="ArrowDown">↓</button>
        <button data-key="" style="visibility:hidden"></button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const SWF_URL = 'https://files.catbox.moe/kk84m9.swf';
      const ruffleContainer = document.getElementById('ruffle-container');
      const ruffle = window.RufflePlayer.newest();

      function loadSWF(url) {
        ruffleContainer.innerHTML = '';
        const player = ruffle.createPlayer();
        player.id = 'ruffle-player';
        player.style.width = '100%';
        player.style.height = '100%';
        ruffleContainer.appendChild(player);
        player.load(url);
      }

      loadSWF(SWF_URL);

      function dispatchKeyEvent(type, code) {
        if (!code) return;
        const ev = new KeyboardEvent(type, { bubbles: true, cancelable: true, composed: true, key: code === 'Space' ? ' ' : '', code });
        window.dispatchEvent(ev);
        try { 
          if (document.getElementById('ruffle-player')?.contentWindow) 
            document.getElementById('ruffle-player').contentWindow.dispatchEvent(ev); 
        } catch(e){}
      }

      document.querySelectorAll('[data-key]').forEach(btn => {
        const code = btn.getAttribute('data-key');
        let active = false;

        const start = e => { e.preventDefault(); if(active) return; active = true; btn.classList.add('active'); dispatchKeyEvent('keydown', code); };
        const end = e => { e.preventDefault(); if(!active) return; active = false; btn.classList.remove('active'); dispatchKeyEvent('keyup', code); };

        btn.addEventListener('touchstart', start);
        btn.addEventListener('mousedown', start);
        btn.addEventListener('touchend', end);
        btn.addEventListener('touchcancel', end);
      });

      window.addEventListener('mouseup', e => {
        document.querySelectorAll('[data-key].active').forEach(btn => {
          const code = btn.getAttribute('data-key');
          btn.classList.remove('active');
          dispatchKeyEvent('keyup', code);
        });
      });
    });
  </script>

</body>
</html>
