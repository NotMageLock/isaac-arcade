<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Isaac Arcade - Dual Joysticks</title>
<style>
html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: center / cover no-repeat url('bg.jpeg'); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 12px; box-sizing: border-box; -webkit-user-select: none; -ms-user-select: none; user-select: none; }
#ruffle-container { width: 100%; max-width: 900px; height: 0; padding-top: 75%; position: relative; border-radius: 8px; overflow: hidden; background: transparent; margin-bottom: 12px; }
#ruffle-player { position: absolute; inset: 0; width: 100%; height: 100%; }
.controls { width: 100%; max-width: 900px; display: flex; gap: 12px; justify-content: space-between; align-items: center; }
.stick { width: 40%; max-width: 320px; aspect-ratio: 1/1; background: rgba(255,255,255,0.06); border-radius: 50%; display: grid; place-items: center; touch-action: none; position: relative; }
.thumb { width: 40%; height: 40%; background: rgba(255,255,255,0.4); border-radius: 50%; position: absolute; left: 30%; top: 30%; transition: left 0.05s, top 0.05s; }
@media(max-width:420px){ .stick { width: 46%; } }
</style>
</head>
<body>

<h1 style="color:white;">Isaac Arcade</h1>
<div id="ruffle-container"></div>

<div class="controls">
  <div class="stick" id="left-stick"><div class="thumb" id="left-thumb"></div></div>
  <div class="stick" id="right-stick"><div class="thumb" id="right-thumb"></div></div>
</div>

<script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const SWF_URL = 'https://files.catbox.moe/kk84m9.swf';
  const ruffleContainer = document.getElementById('ruffle-container');
  const ruffle = window.RufflePlayer.newest();

  const player = ruffle.createPlayer();
  player.id = 'ruffle-player';
  player.style.width = '100%';
  player.style.height = '100%';
  ruffleContainer.appendChild(player);
  player.load(SWF_URL);

  function dispatchKey(type, code){
    const ev = new KeyboardEvent(type, { bubbles:true, cancelable:true, composed:true, key: code==='Space'?' ':code, code });
    try{ player.contentWindow.dispatchEvent(ev); }catch(e){}
  }

  function setupJoystick(stickEl, thumbEl, keyMap){
    let activeKeys = new Set();
    let startX=0, startY=0;

    function start(e){
      e.preventDefault();
      const rect = stickEl.getBoundingClientRect();
      const pos = e.touches?e.touches[0]:e;
      startX = pos.clientX;
      startY = pos.clientY;
      move(pos);
      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
      document.addEventListener('touchmove', move);
      document.addEventListener('touchend', end);
    }

    function move(e){
      e.preventDefault();
      const pos = e.touches?e.touches[0]:e;
      const dx = pos.clientX - startX;
      const dy = pos.clientY - startY;

      let newKeys = new Set();
      if(dy < -30) newKeys.add(keyMap.up);
      if(dy > 30) newKeys.add(keyMap.down);
      if(dx < -30) newKeys.add(keyMap.left);
      if(dx > 30) newKeys.add(keyMap.right);

      activeKeys.forEach(k=>{ if(!newKeys.has(k)) dispatchKey('keyup', k); });
      newKeys.forEach(k=>{ if(!activeKeys.has(k)) dispatchKey('keydown', k); });

      activeKeys = newKeys;

      thumbEl.style.left = `${30 + Math.max(-30, Math.min(30, dx))/stickEl.clientWidth*100}%`;
      thumbEl.style.top = `${30 + Math.max(-30, Math.min(30, dy))/stickEl.clientHeight*100}%`;
    }

    function end(e){
      e.preventDefault();
      activeKeys.forEach(k=>dispatchKey('keyup', k));
      activeKeys.clear();
      thumbEl.style.left = '30%';
      thumbEl.style.top = '30%';
      document.removeEventListener('mousemove', move);
      document.removeEventListener('mouseup', end);
      document.removeEventListener('touchmove', move);
      document.removeEventListener('touchend', end);
    }

    stickEl.addEventListener('mousedown', start);
    stickEl.addEventListener('touchstart', start);
  }

  setupJoystick(document.getElementById('left-stick'), document.getElementById('left-thumb'), {up:'KeyW', down:'KeyS', left:'KeyA', right:'KeyD'});
  setupJoystick(document.getElementById('right-stick'), document.getElementById('right-thumb'), {up:'ArrowUp', down:'ArrowDown', left:'ArrowLeft', right:'ArrowRight'});

});
</script>
</body>
</html>
